<!DOCTYPE html>
<html lang="en">
<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Lagro Reviewer</title>
		<!-- Tailwind CSS -->
		<script src="https://cdn.tailwindcss.com"></script>
		<!-- Chart.js (optional) -->
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<!-- Google Fonts -->
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

		<script>
			tailwind.config = {
				theme: {
					extend: {
						colors: {
							'lagro-green': '#064e3b',
							'lagro-emerald': '#059669',
							'lagro-light': '#ecfdf5',
							'lagro-accent': '#facc15'
						},
						fontFamily: {
							sans: ['Inter', 'sans-serif'],
							serif: ['Playfair Display', 'serif']
						}
					}
				}
			};
		</script>

		<link rel="stylesheet" href="lagro.css">
		<style>
			/* Flashcard box styling to match provided design */
			/* outer wrapper should simply position the boxed card; actual box styling moved to .flashcard-container */
			#flashcard-card {
				padding: 0;
				background: transparent;
				border: none;
				box-shadow: none;
				display: flex;
				align-items: center;
				justify-content: center;
				min-height: 220px;
				transition: transform .12s ease;
			}
			#flashcard-card:active { transform: translateY(1px); }
			#fc-label { text-transform: uppercase; color: #94a3b8; letter-spacing: .12em; font-size: .75rem; }
			#fc-front { color: #0f172a; font-weight: 700; font-size: 1.5rem; }
			#fc-back { color: #475569; font-size: 1rem; }
			#fc-prev, #fc-next { width:44px; height:44px; border-radius:9999px; border:1px solid #eef2f6; background:#fff; display:flex; align-items:center; justify-content:center; box-shadow: 0 6px 20px rgba(2,6,23,0.06); cursor:pointer; }
			#fc-prev:hover, #fc-next:hover { transform: translateY(-2px); }
			#fc-index { background:#eef2f6; padding:8px 12px; border-radius:8px; color:#475569; font-weight:600; }
			/* small responsive tweak */
			@media (min-width: 640px) {
				#flashcard-card { min-height: 220px; }
			}
			/* sized like the example: fixed card box */
			.flashcard-container { perspective: 1000px; width: 100%; max-width: 450px; height: 320px; margin: 0 auto; cursor: pointer; border-radius: 18px; box-shadow: 0 20px 40px rgba(2,6,23,0.06); border: 1px solid #e6eef6; background: #ffffff; display:flex; align-items:center; justify-content:center; }
			.flashcard-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
			.flashcard-inner.is-flipped { transform: rotateY(180deg); }
			/* Front and back faces share identical background/border/shadow so flip looks seamless.
			   Faces are slightly inset so the container background is visible whether flipped or not. */
			.flashcard-front, .flashcard-back {
				position: absolute;
				left: 10px;
				top: 10px;
				width: calc(100% - 20px);
				height: calc(100% - 20px);
				-webkit-backface-visibility: hidden; backface-visibility: hidden;
				display: flex; flex-direction: column; align-items: center; justify-content: center;
				padding: 2.5rem; border-radius: 12px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.08);
				border: 2px solid #e2e8f0; background-color: #ffffff; color: #0f172a;
			}
			.flashcard-back { transform: rotateY(180deg); }
			/* control buttons */
			.fc-action { background:#fff; border:1px solid #eef2f6; padding:8px 10px; border-radius:8px; cursor:pointer; box-shadow: 0 6px 20px rgba(2,6,23,0.04); }
			.fc-action:hover { transform: translateY(-2px); }
			.fc-saved { color: #f59e0b; }
			/* Dark mode: stronger overrides so Tailwind utility classes do not leave white card backgrounds */
			body.dark #flashcard-card { background: transparent !important; }
			body.dark .flashcard-container { background: #071024 !important; border-color: rgba(255,255,255,0.06) !important; box-shadow: 0 20px 40px rgba(2,6,23,0.6) !important; }
			body.dark .flashcard-inner { color: #e6eef8 !important; }
			/* In dark mode both faces use the same background and border so flip stays consistent */
			body.dark .flashcard-front, body.dark .flashcard-back { background-color: #072033 !important; border-color: rgba(255,255,255,0.04) !important; color: #dbeafe !important; }
			body.dark #card-front-text, body.dark #card-back-text { color: #dbeafe !important; }
			body.dark #fc-prev, body.dark #fc-next, body.dark .fc-action { background:#071426 !important; border:1px solid rgba(255,255,255,0.06) !important; color:#e6eef8 !important; box-shadow: 0 6px 20px rgba(2,6,23,0.6) !important; }
			body.dark .fc-action:hover { transform: translateY(-2px); }
		</style>
        
		<!-- tailwind config moved to lagro-tailwind-config.js -->
	</head>
	<body>
		<header class="getblack-header">
			<div class="left-group" onclick="goHome()" style="cursor:pointer">
				<div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-inner overflow-hidden border border-emerald-400">
					<img src="lagro.png" alt="Lagro Logo" class="w-full h-full object-cover" onerror="this.src='data:image/svg+xml;charset=UTF-8,%3Csvg viewBox%3D%220 0 24 24%22 xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath d%3D%22M12 3L1 9l11 6 9-4.91V17h2V9L12 3z%22 fill%3D%22%23064e3b%22%2F%3E%3C%2Fsvg%3E'">
				</div>
				<h1 class="font-serif font-bold text-white text-xl tracking-tight hidden sm:block" style="margin-left:8px">Lagro Reviewer</h1>
			</div>

			<nav class="text-sm font-medium text-emerald-100" style="position:relative; left:0; margin:auto;">
				<button onclick="goHome()" class="hover:text-white transition"></button>
			</nav>

			<div class="right-group">
				<button id="profile-btn" class="flex items-center gap-2 bg-white/10 hover:bg-white/20 text-white px-2 py-1 rounded-md" onclick="toggleProfileMenu(event)">
					<div id="profile-avatar" class="w-8 h-8 bg-white text-lagro-green rounded-full flex items-center justify-center font-bold">U</div>
					<span id="profile-name" class="hidden sm:inline text-sm">User</span>
				</button>
				<span id="profile-gpa-badge" class="hidden gpa-badge">GPA ‚Äî</span>
				<div id="profile-menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border border-emerald-100 z-30 overflow-hidden" style="transform: translateY(6px);">
					<div id="menu-body"></div>
				</div>
			</div>
		</header>


    
	<!-- Insert app main + modals + script (from lagro-reviewer) -->
	<main class="flex-grow relative p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto w-full">
		<div id="view-subjects" class="fade-in">
			<div class="text-center mb-10">
				<h2 class="text-3xl font-serif font-bold text-lagro-green">Academic Dashboard</h2>
				<p class="text-slate-500 mt-2">WAZUP LAGRONIANS!</p>
			</div>
			<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="subject-grid"></div>
		</div>

		<div id="view-lessons" class="hidden fade-in">
			<div class="mb-6">
				<button onclick="goHome()" class="text-xs font-bold text-lagro-emerald hover:text-lagro-green mb-2 flex items-center gap-1">‚Üê BACK TO DASHBOARD</button>
				<h2 id="lesson-page-title" class="text-3xl font-serif font-bold text-lagro-green">Subject Title</h2>
			</div>
			<div class="bg-white rounded-2xl shadow-sm border border-emerald-100 overflow-hidden">
				<ul id="lesson-list" class="divide-y divide-emerald-50"></ul>
			</div>
		</div>

		<div id="view-content" class="hidden fade-in h-full flex flex-col">
			<div class="mb-6 flex-none">
				<button onclick="goBackToLessons()" class="text-xs font-bold text-lagro-emerald hover:text-lagro-green mb-2 flex items-center gap-1">‚Üê BACK TO LESSONS</button>
				<h2 id="content-title" class="text-2xl font-serif font-bold text-lagro-green">Lesson Title</h2>
			</div>

			<div class="flex space-x-1 bg-emerald-50 p-1.5 rounded-xl mb-6 w-full max-w-md mx-auto flex-none shadow-inner">
				<button onclick="switchTab('read')" id="tab-read" class="flex-1 py-2 text-sm font-bold rounded-lg shadow-sm bg-white text-lagro-green transition">READ</button>
				<button onclick="switchTab('visuals')" id="tab-visuals" class="flex-1 py-2 text-sm font-bold rounded-lg text-emerald-700 hover:bg-white/50 transition">CHARTS</button>
				<button onclick="switchTab('quiz')" id="tab-quiz" class="flex-1 py-2 text-sm font-bold rounded-lg text-emerald-700 hover:bg-white/50 transition">QUIZ</button>
				<button onclick="switchTab('flashcards')" id="tab-flashcards" class="flex-1 py-2 text-sm font-bold rounded-lg text-emerald-700 hover:bg-white/50 transition">FLASHCARDS</button>
			</div>

			<div class="flex-grow bg-white rounded-2xl shadow-xl border border-emerald-100 p-6 sm:p-10 relative mb-4">
				<div id="content-read" class="lesson-content"></div>
				<div id="content-visuals" class="hidden h-full flex flex-col items-center justify-center space-y-8"></div>
				<div id="content-quiz" class="hidden"><div id="quiz-wrapper" class="max-w-2xl mx-auto"></div></div>
				<div id="content-flashcards" class="hidden">
					<div id="flashcards-wrapper" class="max-w-3xl mx-auto p-6 bg-emerald-50 rounded-lg overflow-hidden">
						<div class="flex items-center justify-between mb-6">
							<h3 class="font-bold text-lagro-green">Flashcards</h3>
							<div class="text-sm text-slate-600">Click the card to reveal the answer</div>
						</div>

						<div id="flashcard-stage" class="flex flex-col items-center">
							<div id="flashcard-card" class="w-full sm:w-3/4 bg-white rounded-2xl shadow-lg border border-emerald-100 p-10 text-center cursor-pointer select-none" style="min-height:160px;">
								<div class="flashcard-container" id="flashcard-container">
									<div class="flashcard-inner" id="flashcard-inner">
										<div class="flashcard-front">
											<span class="text-xs uppercase tracking-widest text-slate-400 mb-6 font-black">Question</span>
											<h4 id="card-front-text" class="text-2xl font-semibold text-lagro-green">Front</h4>
										</div>
										<div class="flashcard-back">
											<span class="text-xs uppercase tracking-widest text-slate-400 mb-6 font-black">Answer</span>
											<p id="card-back-text" class="text-sm text-slate-600">Back</p>
										</div>
									</div>
								</div>
							</div>

							<div class="flex items-center gap-4 mt-6">
								<button id="fc-prev" class="w-10 h-10 rounded-full bg-white shadow flex items-center justify-center">‚Äπ</button>
								<div id="card-counter" class="px-4 py-2 bg-white rounded text-slate-600">0 / 0</div>
								<button id="fc-next" class="w-10 h-10 rounded-full bg-white shadow flex items-center justify-center">‚Ä∫</button>
								<div class="flex items-center gap-2 ml-3">
									<button id="fc-shuffle" class="fc-action">Shuffle</button>
								</div>
							</div>

							<div class="text-xs text-slate-500 mt-3">Click card to reveal answer ‚Ä¢ Use arrows to navigate</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div id="view-profile" class="hidden fade-in">
			<div class="profile-scroll">
			<div class="mb-6">
				<button onclick="goHome()" class="text-xs font-bold text-lagro-emerald hover:text-lagro-green mb-2 flex items-center gap-1">‚Üê BACK TO DASHBOARD</button>
				<h2 class="text-3xl font-serif font-bold text-lagro-green">Profile</h2>
			</div>

			<div class="bg-white rounded-2xl shadow-xl border border-emerald-100 p-6 sm:p-10">
				<div class="flex flex-col sm:flex-row items-start sm:items-center gap-6">
					<div class="w-28 h-28 bg-emerald-50 rounded-lg flex items-center justify-center text-3xl font-bold text-lagro-green" id="profile-page-avatar">U</div>
					<div class="flex-1">
						<div class="flex items-center justify-between">
							<div>
								<div id="profile-page-name" class="text-2xl font-bold text-lagro-green">Guest User</div>
								<div id="profile-page-email" class="text-sm text-slate-500">‚Äî</div>
							</div>
							<div>
								<button onclick="openProfileModal()" class="px-4 py-2 rounded bg-lagro-emerald text-white">Edit Profile</button>
							</div>
						</div>
						<div class="mt-4">
							<div class="text-sm text-slate-600">Overall GPA: <strong id="profile-page-gpa">‚Äî</strong></div>
							<div class="text-sm text-slate-600 mt-2">Study Effectiveness: <strong id="profile-page-effectiveness">‚Äî</strong></div>
							<div class="mt-3">
								<div class="text-xs text-slate-500 mb-2">Effectiveness Progress</div>
								<div class="w-full bg-slate-100 rounded-full h-3 overflow-hidden">
									<div id="effectiveness-bar" class="h-3 bg-emerald-400" style="width:0%"></div>
								</div>
								<div id="effectiveness-label" class="text-xs text-slate-500 mt-1">‚Äî</div>
							</div>
						</div>
					</div>
				</div>

				<div class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-6">
					<div>
						<h4 class="text-lg font-semibold text-lagro-green">Lesson GPA Breakdown</h4>
						<div id="profile-page-gpa-list" class="mt-3 text-sm text-slate-600"></div>
					</div>
					<div>
						<h4 class="text-lg font-semibold text-lagro-green">Performance Visuals</h4>
						<div class="mt-3 grid grid-cols-1 gap-4">
							<div class="p-3 bg-white rounded shadow-sm">
								<canvas id="gpa-donut" height="140"></canvas>
							</div>
							<div class="p-3 bg-white rounded shadow-sm">
								<canvas id="gpa-bar" height="140"></canvas>
							</div>
						</div>
					</div>
				</div>
				<div class="mt-6">
					<h4 class="text-lg font-semibold text-lagro-green">Recommended Topics To Study</h4>
					<div id="profile-page-recommendations" class="mt-3 text-sm text-slate-600"></div>
				</div>
			</div>
			</div>
		</div>

	</main>

	<!-- Profile Modal -->
	<div id="profile-modal" class="fixed inset-0 hidden items-center justify-center z-40">
		<div class="absolute inset-0 bg-black/40" onclick="closeProfileModal()"></div>
		<div class="bg-white rounded-2xl shadow-xl max-w-lg w-full p-6 z-50">
			<h3 class="text-lg font-bold text-lagro-green mb-4">Your Profile</h3>
			<div class="grid gap-3">
				<label class="text-sm">Name
					<input id="input-name" class="mt-1 w-full border rounded p-2 profile-input" />
				</label>
				<label class="text-sm">Email
					<input id="input-email" class="mt-1 w-full border rounded p-2 profile-input" />
				</label>
			</div>
			<div class="mt-4">
				<div class="text-sm text-slate-600">Overall GPA: <strong id="profile-gpa">‚Äî</strong></div>
				<div id="profile-gpa-list" class="mt-2 text-sm text-slate-500"></div>
			</div>
			<div class="mt-4 flex justify-end gap-2">
				<button onclick="closeProfileModal()" class="px-4 py-2 rounded bg-slate-100">Cancel</button>
				<button onclick="saveProfile()" class="px-4 py-2 rounded bg-lagro-emerald text-white">Save</button>
			</div>
		</div>
	</div>

	<!-- Login Modal -->
	<div id="login-modal" class="fixed inset-0 hidden items-center justify-center z-50">
		<div class="absolute inset-0 bg-black/40" onclick="closeLoginModal()"></div>
		<div class="bg-white rounded-2xl shadow-xl max-w-md w-full p-6 z-50">
			<h3 class="text-lg font-bold text-lagro-green mb-4">Sign In</h3>
			<div class="grid gap-3">
				<label class="text-sm">Email
					<input id="login-email" type="email" class="mt-1 w-full border rounded p-2 profile-input" />
				</label>
				<label class="text-sm">Password
					<input id="login-password" type="password" class="mt-1 w-full border rounded p-2 profile-input" />
				</label>
			</div>
			<div class="mt-4 flex justify-between items-center">
				<div class="text-sm text-slate-500">No backend ‚Äî demo-only login</div>
				<div class="flex gap-2">
					<button onclick="closeLoginModal()" class="px-4 py-2 rounded bg-slate-100">Cancel</button>
					<button onclick="performLogin()" class="px-4 py-2 rounded bg-lagro-emerald text-white">Sign In</button>
				</div>
			</div>
		</div>
	</div>

	<script>
		const subjects = {
			"career": {
				id: "career",
				title: "Life Skills",
				icon: "üéì",
				color: "bg-emerald-50 text-lagro-green border-emerald-200",
				desc: "Higher Education Pathways, Holistic Career Dev, and Employment Types.",
				lessons: [
					{
						id: "l1",
						title: "Lesson 1: Higher Education Pathways",
						desc: "Academic, Vocational, Pathway/Foundation, and Transfer routes.",
						content: {
							read: `
								<h3>1. Academic Pathways</h3>
								<p>Traditional routes focused on theoretical knowledge and academic disciplines.</p>
								<h4>Undergraduate Degrees:</h4>
								<ul>
									<li><strong>Associate Degree:</strong> Usually 2 years at a community or technical college.</li>
									<li><strong>Bachelor‚Äôs Degree:</strong> Usually 3‚Äì4 years at a university or college.</li>
								</ul>
								<h4>Graduate Degrees:</h4>
								<ul>
									<li><strong>Master‚Äôs Degree:</strong> 1‚Äì2 years after a bachelor's degree.</li>
									<li><strong>Doctoral Degree:</strong> 3‚Äì7 years after a master's or directly after a bachelor's.</li>
								</ul>
								<h4>Special Programs:</h4>
								<ul>
									<li><strong>Honors Programs:</strong> For high-achieving undergraduates, often involving research.</li>
									<li><strong>Dual Degrees / Double Majors:</strong> Earning two degrees simultaneously.</li>
									<li><strong>Accelerated Programs:</strong> Faster completion (e.g., 3-year bachelor's); often whole-year round instead of by semester.</li>
									<li><strong>Pre-Professional Programs:</strong> For careers like medicine, law, or education.</li>
								</ul>
								<h3>2. Vocational / Technical Pathways</h3>
								<p>Focused on practical skills and job-specific training.</p>
								<ul>
									<li><strong>Certificates and Diplomas:</strong> Often 6 months to 2 years in technical schools or community colleges.</li>
									<li><strong>Apprenticeships:</strong> Work-based learning with classroom instruction in skilled trades.</li>
									<li><strong>Traineeships:</strong> Similar to apprenticeships, but often shorter and less technical.</li>
								</ul>
								<h3>3. Pathway / Foundation Programs</h3>
								<ul>
									<li><strong>University Foundation Year:</strong> One-year programs preparing students for undergraduate studies.</li>
									<li><strong>English Language Pathways:</strong> For international students needing to improve language skills.</li>
									<li><strong>Bridging Courses:</strong> Short programs to help students meet academic prerequisites.</li>
								</ul>
								<h3>4. Transfer Pathways</h3>
								<ul>
									<li><strong>2+2 Programs:</strong> Start with an associate degree then transfer to a university for the final two years.</li>
									<li><strong>Articulation Agreements:</strong> Formal partnerships that simplify credit transfer.</li>
								</ul>
								<h3>5. Online / Distance Learning Pathways</h3>
								<ul>
									<li><strong>MOOCs:</strong> Massive Open Online Courses (free or low-cost).</li>
									<li><strong>Microcredentials:</strong> Targeted, focused approach to learning a specific practical skill.</li>
									<li><strong>Blended Learning:</strong> A mix of online and on-campus instruction.</li>
								</ul>
							`,
							chartType: "bar",
							quiz: [
								{ q: "How long is a typical Associate Degree?", options: ["1 year", "2 years", "4 years", "6 months"], a: 1 },
								{ q: "Which program is designed for high-achieving undergraduates and often involves research?", options: ["Bridging Course", "Honors Program", "Vocational Course", "Traineeship"], a: 1 },
								{ q: "What is an 'Accelerated Program'?", options: ["A program for athletes", "Faster completion via year-round study", "A program for slow learners", "A degree taken via radio"], a: 1 },
								{ q: "Which pathway focuses on practical skills and job-specific training?", options: ["Academic", "Vocational", "Foundation", "Transfer"], a: 1 },
								{ q: "What does a '2+2' program allow a student to do?", options: ["Take 4 classes", "Transfer from community college to university", "Graduate in 2 years", "Get two degrees in 2 years"], a: 1 },
								{ q: "What are MOOCs?", options: ["Mandatory Online Only Classes", "Massive Open Online Courses", "Major Office Operations Code", "Mixed Online Open Credit"], a: 1 },
								{ q: "Which program is a one-year prep for undergraduate studies?", options: ["Bridging", "University Foundation Year", "Doctoral", "Microcredential"], a: 1 },
								{ q: "What allows entry based on life or work experience?", options: ["RPL", "Dual Degree", "Honors", "Articulations"], a: 0 },
								{ q: "How long are Certificates and Diplomas usually?", options: ["4 years", "6 months to 2 years", "10 years", "1 month"], a: 1 },
								{ q: "What involves work-based learning in skilled trades?", options: ["MOOC", "Apprenticeship", "Bridging", "Associate Degree"], a: 1 }
							]
						}
					},
					{
						id: "l2",
						title: "Lesson 2: Holistic Career Development",
						desc: "Whole person lens and key career choice influences.",
						content: {
							read: `
								<h3>1. Career Pathways: A Holistic Perspective</h3>
								<p>Career development is viewed through a <strong>'whole person' lens</strong>, considering skills, interests, values, personality, life circumstances, and cultural background. Pathways are <strong>not linear</strong>.</p>
								<h3>2. Key Influences on Career Choice</h3>
								<ul>
									<li><strong>Parental Influence:</strong> Recognized as the most significant factor.</li>
									<li><strong>Peer/Media Exposure:</strong> TikTok/YouTube trends (e.g., vloggers, K-pop idols) shape dreams.</li>
									<li><strong>Financial Constraints:</strong> Leads students toward quicker workforce routes (e.g., TESDA NC) over 4-year degrees.</li>
									<li><strong>Gender Roles:</strong> Societal push for females (teaching/caregiving) vs males (engineering/technical).</li>
									<li><strong>Interest and Aptitude:</strong> Central, but can be overridden by external pressures (e.g., parents wanting medical vs IT).</li>
								</ul>
								<h3>3. Summary of Academic/Vocational (Review)</h3>
								<p>This lesson reiterates that Academic pathways are theoretical, while Vocational pathways are practical skills-based.</p>
							`,
							chartType: "doughnut",
							quiz: [
								{ q: "What is the 'most significant' factor in career choice?", options: ["Media", "Peers", "Parental Influence", "Weather"], a: 2 },
								{ q: "Career pathways are described as being:", options: ["Linear", "Not linear", "Strictly vertical", "Short"], a: 1 },
								{ q: "The 'whole person' lens includes which of the following?", options: ["Only skills", "Interests, values, and life circumstances", "Only grades", "Strictly financial status"], a: 1 },
								{ q: "Why might a student choose a TESDA NC course over a 4-year degree?", options: ["They hate studying", "Financial constraints", "Gender roles", "It's more prestigious"], a: 1 },
								{ q: "Social trends on which platforms play a role in career choice?", options: ["Newspapers", "TikTok and YouTube", "Radio", "Posters"], a: 1 },
								{ q: "Gender roles often push males toward which fields?", options: ["Caregiving", "Engineering/Technical", "Teaching", "Nursing"], a: 1 },
								{ q: "What can sometimes override a student's aptitude?", options: ["Internal hobbies", "External pressures (e.g. Parents)", "Reading speed", "Sleep habits"], a: 1 },
								{ q: "Gender roles often push females toward which fields?", options: ["Aviation", "Teaching/Caregiving", "Construction", "Mining"], a: 1 },
								{ q: "A 'Holistic Perspective' considers which of the following?", options: ["Cultural background", "Personality", "Life circumstances", "All of the above"], a: 3 },
								{ q: "Vocational pathways are focused on what?", options: ["Theoretical research", "Practical skills/Job-specific training", "Pure philosophy", "Ancient history"], a: 1 }
							]
						}
					},
					{
						id: "l3",
						title: "Lesson 3: Types of Employment",
						desc: "Work hours, duration, and relationship with employers.",
						content: {
							read: `
								<h3>1. Definition of Employment Types</h3>
								<p>Describes the nature of a work arrangement, categorized by hours, duration, and worker-employer relationship.</p>
								<h3>2. By Work Hours and Duration</h3>
								<ul>
									<li><strong>Full-Time:</strong> Considered permanent and have job security.</li>
									<li><strong>Part-Time:</strong> Typically paid an hourly wage with limited or no benefits.</li>
									<li><strong>Casual:</strong> Work is flexible but provides no job security or paid leave.</li>
									<li><strong>Seasonal:</strong> Employment is temporary and ends when the season is over.</li>
								</ul>
								<h3>3. By Relationship with Employer</h3>
								<ul>
									<li><strong>Gig:</strong> The worker is an independent contractor, not a traditional employee.</li>
									<li><strong>Freelance:</strong> Operates own business, sets own hours, handles own taxes and benefits.</li>
									<li><strong>Contractual:</strong> Governed by a contract outlining start/end dates, scope, and pay.</li>
								</ul>
								<h3>4. Resume</h3>
								<p>A resume originated from the French word <strong>r√©sum√©</strong>, which means <strong>'summary'</strong>.</p>
							`,
							chartType: "none",
							quiz: [
								{ q: "Which employment type is considered permanent with job security?", options: ["Casual", "Seasonal", "Full-Time", "Gig"], a: 2 },
								{ q: "What does the French word 'r√©sum√©' mean?", options: ["Job", "History", "Summary", "Letter"], a: 2 },
								{ q: "Which type of employment has no job security or paid leave?", options: ["Full-Time", "Contractual", "Casual", "Permanent"], a: 2 },
								{ q: "In which type is the worker an independent contractor, not an employee?", options: ["Full-Time", "Seasonal", "Gig", "Part-Time"], a: 2 },
								{ q: "Freelancers are responsible for their own:", options: ["Taxes", "Benefits", "Hours", "All of the above"], a: 3 },
								{ q: "Which employment ends when a specific season is over?", options: ["Full-Time", "Casual", "Seasonal", "Freelance"], a: 2 },
								{ q: "How are Part-Time workers typically paid?", options: ["Annual salary", "Hourly wage", "Gift cards", "Unpaid"], a: 1 },
								{ q: "Which arrangement is governed by start/end dates and specific scope of work?", options: ["Casual", "Contractual", "Gig", "Permanent"], a: 1 },
								{ q: "What describes the nature of a work arrangement?", options: ["Aptitude", "Employment Type", "Personality", "Major"], a: 1 },
								{ q: "Which worker operates their own business and sets their own hours?", options: ["Full-Time Employee", "Freelancer", "Casual Worker", "Seasonal Worker"], a: 1 }
							]
						}
					}
				]
			},
			"science": {
				id: "science",
				title: "General Science",
				icon: "üåç",
				color: "border-blue-200 bg-blue-50",
				desc: "Earth, planets, and what makes our planet capable of supporting life.",
				lessons: [
					{
						id: "s1",
						week: "Week 1",
						title: "Earth vs. The Rest: What Makes Our Planet Alive?",
						desc: "Characteristics that make Earth unique and capable of supporting life.",
						content: {
							read: `
							<div class="objective-box">
								<h4 class="mt-0 text-green-800">Learning Objectives</h4>
								<ul class="mb-0">
									<li>Identify and explain the specific characteristics of Earth that sustain life.</li>
									<li>Compare Earth‚Äôs traits with other terrestrial and gas giant planets.</li>
									<li>Describe how the greenhouse effect regulates our planet's temperature.</li>
									<li>Reflect on the importance of environmental stewardship.</li>
								</ul>
							</div>

							<h2>Comparing the Planets</h2>
							<p>Planets in our solar system are categorized by their composition and distance from the Sun.</p>

							<h3>Terrestrial (Inner) Planets</h3>
							<p>These planets have solid surfaces and are located in the inner solar system.</p>
							<ul>
								<li><strong>Mercury:</strong> A solid planet with no atmosphere and extreme temperature swings.</li>
								<li><strong>Venus:</strong> A solid planet with a thick $CO_{2}$ atmosphere; it is the hottest planet in the solar system.</li>
								<li><strong>Earth:</strong> The only planet confirmed to support life, featuring liquid water, a breathable atmosphere, and a protective magnetic field.</li>
								<li><strong>Mars:</strong> A solid planet with a thin atmosphere and signs of past water, leading some to believe it may have once supported life.</li>
							</ul>

							<h3>Gas and Ice Giants (Outer) Planets</h3>
							<p>These are large, gaseous planets located in the outer solar system that cannot support life.</p>
							<ul>
								<li><strong>Jupiter:</strong> The largest planet, known for its "Great Red Spot" storm.</li>
								<li><strong>Saturn:</strong> Characterized by its prominent icy rings and many moons.</li>
								<li><strong>Uranus:</strong> The coldest planet, featuring a tilted axis and a methane-rich atmosphere.</li>
								<li><strong>Neptune:</strong> The farthest planet from the Sun, known for its strong winds.</li>
							</ul>

							<h2>Why Earth is Unique</h2>
							<p>Earth possesses a "rare and balanced" combination of features that allow life to thrive.</p>
							<ul>
								<li><strong>The Goldilocks Zone:</strong> Earth is at the right distance from the Sun‚Äîneither too hot nor too cold‚Äîallowing liquid water to exist.</li>
								<li><strong>Liquid Water:</strong> Approximately 71% of Earth is covered in water, which regulates temperature and sustains life.</li>
								<li><strong>Suitable Atmosphere:</strong> Earth has the right mix of gases to keep the planet warm and protect it from radiation.</li>
								<li><strong>Magnetic Field:</strong> This shield protects the atmosphere and organisms from solar winds and cosmic radiation.</li>
								<li><strong>Moderate Temperature:</strong> A stable temperature range supports diverse ecosystems.</li>
								<li><strong>Gravity:</strong> Earth‚Äôs gravity is strong enough to retain its dense atmosphere and oceans.</li>
								<li><strong>Ozone Layer:</strong> This layer specifically filters out the Sun's harmful UV radiation.</li>
								<li><strong>Active Geology:</strong> Plate movements help recycle minerals and nutrients while maintaining a stable climate.</li>
								<li><strong>Stable Rotation and Tilt:</strong> This creates the day/night cycles and seasons necessary for different life cycles.</li>
								<li><strong>Essential Elements:</strong> Earth provides an abundance of building blocks for life, such as Carbon, Hydrogen, Oxygen, Nitrogen, Phosphorus, and Sulfur.</li>
							</ul>

							<h2>The Greenhouse Effect</h2>
							<p>The greenhouse effect is a natural process where specific gases trap heat to maintain a habitable temperature. Without these gases, Earth would likely be too cold to sustain life; however, having too many greenhouse gases can lead to excessive warming.</p>

							<div class="pledge-box">
								<h4 class="mt-0 text-amber-800 uppercase tracking-wider text-xs font-bold mb-2">Stewardship Pledge</h4>
								<p>You are encouraged to reflect on how human-induced climate change threatens this 13.8-billion-year-old process and commit to protecting the planet.</p>
							</div>
						`,

							chart: { type: 'pie', labels: ['Water (71%)', 'Land (29%)'], data: [71, 29], label: 'Earth Surface Composition', desc: 'The high percentage of liquid water is a key factor in Earth\'s ability to regulate temperature and sustain diverse life forms.' },
							quiz: [
								{ q: "Which planet is the hottest in our solar system?", options: ["Mercury","Venus","Earth","Jupiter"], a: 1 },
								{ q: "What do we call the region around a star where liquid water can exist?", options: ["The Life Belt","The Water Ring","The Goldilocks Zone","The Earth Sector"], a: 2 },
								{ q: "Which gas makes the atmosphere of Venus so thick and hot?", options: ["Carbon Dioxide","Oxygen","Methane","Argon"], a: 0 },
								{ q: "The 'Outer Planets' are primarily composed of:", options: ["Solid Rock","Gas and Ice","Liquid Metal","Frozen Carbon"], a: 1 },
								{ q: "What percentage of Earth's surface is covered by water?", options: ["50%","71%","29%","85%"], a: 1 },
								{ q: "Which shield protects Earth from solar winds and cosmic radiation?", options: ["Ozone Layer","The Crust","Magnetic Field","The Moon"], a: 2 },
								{ q: "Which planet is known for its prominent icy rings?", options: ["Uranus","Jupiter","Neptune","Saturn"], a: 3 },
								{ q: "What is the primary function of the Ozone Layer?", options: ["Filtering UV Radiation","Trapping Heat","Creating Oxygen","Stopping Meteors"], a: 0 },
								{ q: "Earth's gravity is unique because it is strong enough to:", options: ["Pull in other planets","Retain a dense atmosphere","Stop the Earth's rotation","Make us weightless"], a: 1 },
								{ q: "What would happen to Earth without the natural greenhouse effect?", options: ["It would be too hot","It would lose gravity","It would be too cold for life","The oceans would evaporate"], a: 2 }
							]
						}
						},
					{
						id: "s2",
						week: "Week 2",
						title: "Week 2: Greenhouse Effect & Earth's Temperature",
						desc: "How the atmosphere acts as a natural blanket and the impact of human enhancement.",
						content: {
							read: `
							<div class="objective-box">
								<h4 class="font-bold text-lagro-green">Week 2 Objectives</h4>
								<ul>
									<li>Define the natural greenhouse effect.</li>
									<li>Identify major greenhouse gases (GHGs).</li>
									<li>Understand the "Blanket Analogy".</li>
									<li>Distinguish between Natural and Human-Enhanced effects.</li>
								</ul>
							</div>

							<h2>Overview</h2>
							<p>The greenhouse effect is a <strong>natural process</strong> where specific atmospheric gases trap heat. It regulates Earth's average temperature, keeping it from being a frozen wasteland.</p>

							<h3>Key Greenhouse Gases (GHGs)</h3>
							<ul>
								<li><strong>Carbon Dioxide ($CO_2$):</strong> Emitted by burning fossil fuels and deforestation. Most abundant human emission.</li>
								<li><strong>Methane ($CH_4$):</strong> From livestock, landfills, and wetlands. Traps more heat than $CO_2$.</li>
								<li><strong>Nitrous Oxide ($N_2O$):</strong> From fertilizers and industrial processes.</li>
								<li><strong>Water Vapor:</strong> The most abundant natural GHG; amplifies warming.</li>
								<li><strong>Fluorinated Gases:</strong> Synthetic chemicals (CFCs/HFCs) used in refrigerants.</li>
							</ul>

							<h3>The "Blanket Analogy"</h3>
							<p>The atmosphere acts like a blanket. It lets sunlight (Solar Radiation) in but traps the heat (Infrared Radiation) trying to escape. If the blanket is too thin, Earth freezes. If it's too thick (Human-Enhanced), Earth over-warms.</p>

							<h3>Important Vocabulary</h3>
							<div class="vocab-item"><strong>Solar Radiation:</strong> Energy coming from the sun.</div>
							<div class="vocab-item"><strong>Absorb:</strong> To soak up energy.</div>
							<div class="vocab-item"><strong>Reflect:</strong> To bounce off without soaking up.</div>
							<div class="vocab-item"><strong>Re-emit:</strong> To send energy back out after absorbing it.</div>
						`,
							chart: {
								type: 'bar',
								labels: ['CO2', 'Methane', 'Nitrous Oxide', 'F-Gases'],
								data: [1, 28, 265, 12000],
								desc: "While CO2 is most abundant, gases like Methane and F-Gases have a much higher 'Global Warming Potential' per molecule."
							},
							quiz: [
								{ q: "The greenhouse effect is primarily a ______ process.", options: ["Harmful", "Natural", "Artificial", "Dangerous"], a: 1 },
								{ q: "Which gas is considered the most abundant 'natural' greenhouse gas?", options: ["Oxygen", "Carbon Dioxide", "Water Vapor", "Argon"], a: 2 },
								{ q: "What analogy is used to describe how the atmosphere keeps Earth warm?", options: ["The Sponge Analogy", "The Blanket Analogy", "The Mirror Analogy", "The Filter Analogy"], a: 1 },
								{ q: "Methane ($CH_4$) is mainly emitted from which source?", options: ["Deforestation", "Livestock and Landfills", "Aerosol Cans", "Oceans"], a: 1 },
								{ q: "Burning fossil fuels primarily increases which gas?", options: ["Nitrogen", "Oxygen", "Carbon Dioxide", "Neon"], a: 2 },
								{ q: "Energy coming from the sun is called:", options: ["Infrared Radiation", "Solar Radiation", "Thermal Energy", "Microwaves"], a: 1 },
								{ q: "What happens to Earth's temperature if the 'blanket' of GHGs becomes too thick?", options: ["It cools down", "It stays the same", "It increases (over-warms)", "It loses its atmosphere"], a: 2 },
								{ q: "Which of these is a synthetic, powerful heat-trapper used in refrigerants?", options: ["Water Vapor", "Fluorinated Gases", "Methane", "Ozone"], a: 1 },
								{ q: "To 'bounce off a surface without being soaked up' is to:", options: ["Absorb", "Reflect", "Re-emit", "Conduct"], a: 1 },
								{ q: "Nitrous Oxide ($N_2O$) primarily results from:", options: ["Volcanoes", "Fertilizers", "Respiration", "Lightning"], a: 1 },
								{ q: "Which gas traps significantly more heat per molecule than $CO_2$?", options: ["Oxygen", "Nitrogen", "Methane", "Hydrogen"], a: 2 },
								{ q: "The term for taking in or soaking up energy is:", options: ["Reflect", "Absorb", "Radiate", "Emit"], a: 1 },
								{ q: "The 'Human-Enhanced' greenhouse effect leads to:", options: ["Ice Ages", "Global Warming", "Atmospheric Loss", "More Oxygen"], a: 1 },
								{ q: "Ground-level Ozone is formed by:", options: ["Plants", "Vehicle and Industrial emissions", "Sea spray", "Meteors"], a: 1 },
								{ q: "If Earth lacked a greenhouse effect completely, it would be:", options: ["Exactly the same", "Extremely hot", "Vastly colder", "Full of life"], a: 2 },
								{ q: "Infrared radiation is another term for:", options: ["Visible light", "Heat", "UV rays", "X-rays"], a: 1 },
								{ q: "Which gas is a pollutant at ground level but traps heat?", options: ["Nitrogen", "Argon", "Ozone", "Helium"], a: 2 },
								{ q: "Deforestation contributes to the increase of:", options: ["Methane", "Nitrous Oxide", "Carbon Dioxide", "Water Vapor"], a: 2 },
								{ q: "To send energy back out after it has been absorbed is to:", options: ["Reflect", "Re-emit", "Sublime", "Condense"], a: 1 },
								{ q: "Earth's 'Goldilocks Zone' status is maintained by the balance of:", options: ["Distance and Atmosphere", "The Moon and Stars", "Oceans and Fish", "Wind and Rain"], a: 0 }
							]
						}
					},

					{
					id: "s3",
					week: "Week 3",
					title: "Geology: The Formation of the Philippines",
					desc: "Core vocabulary, tectonic plates, and the unique origin of our archipelago.",
					content: { // Added this wrapper
						read: `
							<div class="objective-box">
								<h4 class="font-bold">Core Vocabulary</h4>
								<ul class="text-sm">
									<li><strong>Archipelago:</strong> A large cluster of islands often sharing a common geological origin.</li>
									<li><strong>Convergent Boundary:</strong> A region where two tectonic plates collide (Destructive Boundary).</li>
									<li><strong>Subduction:</strong> Process where one plate is forced beneath another into the mantle.</li>
									<li><strong>Trench:</strong> Long, steep-sided depressions on the ocean floor at subduction zones.</li>
									<li><strong>Island Arc:</strong> Curved chain of volcanic islands parallel to a trench.</li>
									<li><strong>Philippine Mobile Belt:</strong> Seismically active zone of crustal deformation making up most of the PH.</li>
									<li><strong>Pacific Ring of Fire:</strong> A 40,000-km horseshoe region of intense volcanic/seismic activity.</li>
								</ul>
							</div>

							<h2>The Formation of the Philippines</h2>
							<p>The Philippine Archipelago was formed over millions of years through the collision of tectonic plates and intense volcanic activity. It sits at a complex junction of three major plates:</p>
							
							<ul>
								<li><strong>Eurasian Plate</strong> (specifically the Sunda Plate) to the west.</li>
								<li><strong>Philippine Sea Plate</strong> to the east.</li>
								<li><strong>Indo-Australian Plate</strong> to the south.</li>
							</ul>

							<h3>Mechanisms of Creation</h3>
							<p><strong>1. Subduction and Volcanism:</strong> Oceanic plates collide and melt into magma as they sink. This rising magma creates volcanic island arcs.</p>
							
							<p><strong>2. Tectonic Collision and Accretion:</strong> Continuous convergence causes arcs and landmasses to merge. Example: Palawan Microcontinental Block colliding with the Philippine Mobile Belt.</p>

							<h2>Geological Stability</h2>
							<p>The "mobile" in <strong>Philippine Mobile Belt</strong> means the region is restless and unstable. Being "sandwiched" between subducting plates makes it one of the most seismically active regions on Earth.</p>
							<p>Our shape is a <strong>"work in progress"</strong>. Volcanic activity adds land, while trenches "consume" the edges of the islands into the mantle.</p>

							<h2>The Unique Ancestry of Palawan</h2>
							<p>Unlike the rest of the country (born from volcanoes), <strong>Palawan was once part of mainland Asia.</strong></p>
							<ul>
								<li><strong>Collision:</strong> 11-20 million years ago, the Palawan block crashed into the volcanic Philippine Mobile Belt.</li>
								<li><strong>Stability:</strong> Sitting on ancient continental crust, Palawan has no active volcanoes and fewer earthquakes.</li>
								<li><strong>Biology:</strong> Its plants and animals are more similar to mainland Southeast Asia than the rest of the PH.</li>
							</ul>

							<h2>Benefits of Volcanic Formation</h2>
							<ol>
								<li><strong>Geothermal Energy:</strong> The PH is a global leader, providing 9% to 27% of our electricity.</li>
								<li><strong>Fertile Soil:</strong> Volcanic ash creates nutrient-rich soil for crops like sugar, abaca, and coffee.</li>
								<li><strong>Mineral Resources:</strong> Rich in gold, copper, silver, and nickel.</li>
								<li><strong>Tourism:</strong> Landmarks like Mt. Mayon and Taal support local eco-tourism.</li>
							</ol>
						`,
						visual: {
							title: "Tectonic Junction Distribution",
							type: 'pie',
							labels: ['Eurasian Plate', 'Philippine Sea Plate', 'Indo-Australian Plate'],
							data: [40, 40, 20],
							desc: "The Philippines is primarily influenced by these three major tectonic plates."
						},
						cards: [
							{ front: "What is an Archipelago?", back: "A large cluster of islands sharing a common geological origin." },
							{ front: "Define Convergent Boundary.", back: "A region where two tectonic plates collide (destructive boundary)." },
							{ front: "What is Subduction?", back: "The process of one plate sinking beneath another into the mantle." },
							{ front: "What are Trenches?", back: "Deep oceanic depressions formed at subduction zones." },
							{ front: "What is the Philippine Mobile Belt?", back: "A restless, seismically active zone making up most of the PH." },
							{ front: "What are the 3 plates meeting at the PH?", back: "Eurasian, Philippine Sea, and Indo-Australian plates." },
							{ front: "Why is Palawan unique?", back: "It originated from mainland Asia, not underwater volcanoes." },
							{ front: "How old was the Palawan-Mobile Belt collision?", back: "Roughly 11 to 20 million years ago." },
							{ front: "Most stable part of the Philippines?", back: "Palawan (continental crust, no active volcanoes)." },
							{ front: "Percentage of PH electricity from Geothermal?", back: "9% to 27%." },
							{ front: "What adds new land to the PH?", back: "Volcanic activity." },
							{ front: "What 'consumes' the edges of our islands?", back: "Trenches (subduction)." },
							{ front: "Primary mechanism of island arc creation?", back: "Rising magma from subducting oceanic plates." },
							{ front: "Common minerals found due to tectonic process?", back: "Gold, copper, silver, and nickel." },
							{ front: "Example of a landmark for eco-tourism?", back: "Mt. Mayon or Taal Volcano." },
							{ front: "Why are Palawan's animals similar to mainland Asia?", back: "Because of its mainland continental origin." },
							{ front: "Length of the Pacific Ring of Fire?", back: "40,000 kilometers." },
							{ front: "What kind of soil does volcanic ash produce?", back: "Fertile, nutrient-rich soil." },
							{ front: "Is the PH shape final?", back: "No, it is a 'work in progress' due to active tectonics." },
							{ front: "Definition of Island Arc?", back: "Curved chain of volcanic islands parallel to a trench." }
						],
						quiz: [
							{ q: "Which region is characterized by intense volcanic and seismic activity in a horseshoe shape?", options: ["Philippine Belt", "Pacific Ring of Fire", "Eurasian Plate", "Atlantic Ridge"], a: 1 },
							{ q: "The process where one plate is forced beneath another is called:", options: ["Accretion", "Subduction", "Erosion", "Sedimentation"], a: 1 },
							{ q: "Which plate lies to the west of the Philippines?", options: ["Philippine Sea Plate", "Indo-Australian Plate", "Eurasian Plate", "Pacific Plate"], a: 2 },
							{ q: "Why is the Philippine Mobile Belt called 'mobile'?", options: ["Because islands move with tides", "Because it is highly unstable and restless", "Because people move frequently", "Because of its transportation system"], a: 1 },
							{ q: "Which part of the Philippines was once part of mainland Asia?", options: ["Luzon", "Visayas", "Mindanao", "Palawan"], a: 3 },
							{ q: "Roughly how many years ago did Palawan collide with the Mobile Belt?", options: ["1-5 million", "50-100 million", "11-20 million", "100-200 million"], a: 2 },
							{ q: "Which is a benefit of volcanic formation in the Philippines?", options: ["Frequent Earthquakes", "Geothermal Energy", "Ocean Trenches", "Typhoons"], a: 1 },
							{ q: "What percentage of the nation's electricity can geothermal power provide?", options: ["1-5%", "9-27%", "50-60%", "75-90%"], a: 1 },
							{ q: "Which of these crops benefit from volcanic soil in Negros?", options: ["Wheat", "Sugar", "Rice", "Corn"], a: 1 },
							{ q: "The 'edges' of the islands are being consumed at:", options: ["Volcanoes", "Trenches", "Rivers", "Mountains"], a: 1 },
							{ q: "What is a 'Trench'?", options: ["A mountain peak", "A steep depression on the ocean floor", "A volcanic crater", "A flat plain"], a: 1 },
							{ q: "Which plate is to the south of the PH?", options: ["Eurasian", "Philippine Sea", "Indo-Australian", "Antarctic"], a: 2 },
							{ q: "Why does Palawan have fewer earthquakes?", options: ["It is small", "It sits on ancient continental crust", "It is near the equator", "It has more trees"], a: 1 },
							{ q: "Volcanic ash helps the industry of:", options: ["Steel", "Sugar", "Textile", "Electronics"], a: 1 },
							{ q: "A large cluster of islands is called an:", options: ["Arc", "Archipelago", "Atoll", "Isthmus"], a: 1 },
							{ q: "Convergent boundaries are also known as:", options: ["Constructive", "Destructive", "Transform", "Passive"], a: 1 },
							{ q: "What rises from the mantle to create island arcs?", options: ["Water", "Magma", "Air", "Gold"], a: 1 },
							{ q: "Tectonic processes make PH rich in:", options: ["Oil", "Minerals like Gold/Copper", "Coal", "Diamonds"], a: 1 },
							{ q: "The collision that assembled the current PH structure involved Palawan and:", options: ["Eurasian Plate", "Philippine Mobile Belt", "Japan", "Borneo"], a: 1 },
							{ q: "Palawan's biology is similar to:", options: ["Australia", "Mainland SE Asia", "Hawaii", "Japan"], a: 1 }
						]
					}
				}
				]
			},

			"physics": {
				id: "physics",
				title: "Physics",
				icon: "‚öõÔ∏è",
				color: "bg-blue-50 text-blue-900 border-blue-200",
				desc: "Mechanics, thermodynamics, and the laws that govern energy and matter.",
				lessons: [
					{
						id: "P1",
						title: "Lesson 1: Heat and Thermodynamics",
						desc: "Complete study notes on the Foundations of Thermodynamics and Heat Transfer.",
						content: {
							read: `
							<div class="objective-box">
								<h4 class="font-bold text-blue-900">Foundations of Thermodynamics</h4>
								<p>Thermodynamics is the branch of physics that deals with heat, work, and temperature, and their relation to energy and radiation.</p>
							</div>

							<h2>The Zeroth Law of Thermodynamics</h2>
							<p><strong>Definition:</strong> If two systems (A and B) are each in thermal equilibrium with a third system (C), then they are in thermal equilibrium with each other.</p>
							<p><strong>Key Concept:</strong> This law defines the concept of <strong>temperature</strong>. When systems are in thermal equilibrium, they share the same temperature, and no net heat flows between them.</p>

							<h2>What is Temperature?</h2>
							<p><strong>Definition:</strong> A measure of the <strong>average kinetic energy</strong> of particles in a substance. It indicates how fast molecules are moving on average.</p>
							<div class="vocab-item">
								<strong>Important Distinction:</strong> A higher temperature does not necessarily mean a substance has more total heat energy (which also depends on mass and material).
							</div>
							<h3>Common Units:</h3>
							<ul>
								<li><strong>Celsius (¬∞C):</strong> Used globally in most countries.</li>
								<li><strong>Kelvin (K):</strong> The SI unit used for scientific work.</li>
								<li><strong>Fahrenheit (¬∞F):</strong> Used primarily in the United States.</li>
							</ul>

							<h2>What is Heat?</h2>
							<p><strong>Definition:</strong> Heat is <strong>energy in transit</strong>. It is the energy transferred between objects or systems due to a temperature difference.</p>
							<ul>
								<li><strong>Flow Direction:</strong> Heat always flows spontaneously from regions of higher temperature to regions of lower temperature.</li>
								<li><strong>Measurement:</strong> Measured in Joules (J) or calories.</li>
								<li><strong>Equilibrium:</strong> Heat flow continues until thermal equilibrium is reached (temperatures are equal).</li>
							</ul>

							<h2>Methods of Heat Transfer</h2>
                            
							<h3>1. Conduction</h3>
							<div class="vocab-item">
								<strong>Mechanism:</strong> Heat transfer through direct contact or the movement of electrons within a substance.<br>
								<strong>Medium:</strong> Requires a medium; occurs mainly in solids.<br>
								<strong>Speed:</strong> Generally the slowest method of heat transfer.
							</div>

							<h3>2. Convection</h3>
							<div class="vocab-item">
								<strong>Mechanism:</strong> Heat transfer by the actual movement of fluids (liquids or gases).<br>
								<strong>Process:</strong>
								<ul class="mt-2">
									<li>Fluid near a heat source warms and expands.</li>
									<li>The warm fluid becomes less dense and rises.</li>
									<li>Cooler, denser fluid moves in to replace it.</li>
									<li>This creates a continuous cycle called a <strong>convection current</strong>.</li>
								</ul>
								<strong>Examples:</strong> Boiling water, ocean currents, weather patterns, and home heating systems.<br>
								<strong>Speed:</strong> Faster than conduction; categorized as medium speed.
							</div>

							<h3>3. Radiation</h3>
							<div class="vocab-item">
								<strong>Mechanism:</strong> Heat transfer by <strong>electromagnetic waves</strong>.<br>
								<strong>Medium:</strong> Does not require a medium; it can travel through the vacuum of space and through transparent materials.<br>
								<strong>Key Property:</strong> Every object emits thermal radiation based on its temperature.<br>
								<strong>Speed:</strong> The fastest method, traveling at the speed of light ($3 \times 10^8 \text{ m/s}$).<br>
								<strong>Examples:</strong> Sunlight warming the Earth, heat from a campfire, and infrared heaters.
							</div>
						`,
							chart: { type: 'bar', labels: ['Conduction', 'Convection', 'Radiation'], data: [1,5,100], label: 'Methods of Heat Transfer Speed', desc: 'Relative comparison: Radiation is instantaneous (speed of light), Convection is medium (fluid flow), and Conduction is slowest (vibration transfer).' },
							quiz: [
								{ q: "Which law defines the concept of temperature?", options: ["First Law", "Second Law", "Zeroth Law", "Third Law"], a: 2 },
								{ q: "If system A and B are in equilibrium with C, they are in equilibrium with each other. This is:", options: ["Newton's Law", "Zeroth Law", "Law of Cooling", "Convection"], a: 1 },
								{ q: "Temperature measures the ______ kinetic energy of particles.", options: ["Total", "Minimum", "Average", "Potential"], a: 2 },
								{ q: "Which temperature unit is considered the SI unit?", options: ["Celsius", "Kelvin", "Fahrenheit", "Rankine"], a: 1 },
								{ q: "Heat is defined as energy in ______.", options: ["Storage", "Transit", "Solid form", "Equilibrium"], a: 1 },
								{ q: "Spontaneous heat flow occurs from:", options: ["Low to High Temp", "High to Low Temp", "Inside to Outside only", "Cold to Warm"], a: 1 },
								{ q: "Heat transfer through direct contact is called:", options: ["Radiation", "Convection", "Conduction", "Induction"], a: 2 },
								{ q: "Conduction occurs mainly in which state of matter?", options: ["Gases", "Liquids", "Solids", "Plasma"], a: 2 },
								{ q: "Which method involve the movement of liquids or gases?", options: ["Conduction", "Radiation", "Convection", "Friction"], a: 2 },
								{ q: "What is created when warm fluid rises and cool fluid sinks?", options: ["Radiation wave", "Convection current", "Conductive path", "Vacuum"], a: 1 },
								{ q: "Boiling water is a primary example of:", options: ["Radiation", "Convection", "Conduction", "Equilibrium"], a: 1 },
								{ q: "Heat transfer via electromagnetic waves is:", options: ["Convection", "Conduction", "Radiation", "Expansion"], a: 2 },
								{ q: "Which method can travel through the vacuum of space?", options: ["Convection", "Conduction", "Radiation", "All of them"], a: 2 },
								{ q: "Thermal radiation travels at what speed?", options: ["Speed of sound", "1,000 m/s", "Speed of light", "Varies greatly"], a: 2 },
								{ q: "Generally, the slowest method of heat transfer is:", options: ["Radiation", "Convection", "Conduction", "They are equal"], a: 2 },
								{ q: "When temperatures are equal and no net heat flows, the systems are in:", options: ["Thermal Stasis", "Thermal Equilibrium", "Thermal Zero", "Isotope"], a: 1 },
								{ q: "Units for heat energy are Joules or ______.", options: ["Newtons", "Calories", "Watts", "Amps"], a: 1 },
								{ q: "Why does warm fluid rise?", options: ["It becomes more dense", "It becomes less dense", "Gravity pushes it up", "It turns into gas"], a: 1 },
								{ q: "Sunlight warming the Earth is an example of:", options: ["Conduction", "Convection", "Radiation", "Direct Contact"], a: 2 },
								{ q: "True or False: Higher temperature always means more total heat energy.", options: ["True", "False"], a: 1 }
							]
						}
					}
				]
			}
		};

		let currentSubject = null, currentLesson = null, currentChart = null;
		let currentQuizState = null;

		function goHome() { currentSubject = null; currentLesson = null; renderSubjects(); showView('view-subjects'); updateBreadcrumbs(); }
		function selectSubject(id) { currentSubject = subjects[id]; renderLessons(); showView('view-lessons'); updateBreadcrumbs(); }
		function goBackToLessons() { currentLesson = null; showView('view-lessons'); updateBreadcrumbs(); }
		function selectLesson(id) { currentLesson = currentSubject.lessons.find(l => l.id === id); renderContent(); showView('view-content'); updateBreadcrumbs(); }
		function showView(id) { ['view-subjects', 'view-lessons', 'view-content', 'view-profile'].forEach(v => { const el = document.getElementById(v); if (el) el.classList.add('hidden'); }); const target = document.getElementById(id); if (target) target.classList.remove('hidden'); }

		// Ensure main content is offset below the header so fixed/overlapping headers won't hide view top
		function adjustForHeader() {
			try {
				const hdr = document.querySelector('header');
				const main = document.querySelector('main');
				if (hdr && main) {
					const pad = hdr.offsetHeight + 12; // small gap
					main.style.paddingTop = pad + 'px';
				}
			} catch (e) {}
		}

		// initialize hide-on-scroll header: hide when scrolling down, show when scrolling up
		function initHeaderScroll() {
			const hdr = document.querySelector('.getblack-header');
			if (!hdr) return;
			let lastY = window.scrollY || 0;
			let ticking = false;
			const threshold = 10;
			window.addEventListener('scroll', () => {
				const y = window.scrollY || 0;
				if (!ticking) {
					window.requestAnimationFrame(() => {
						if (y - lastY > threshold && y > 50) {
							hdr.classList.add('header-hidden');
						} else if (lastY - y > threshold) {
							hdr.classList.remove('header-hidden');
						}
						lastY = y;
						ticking = false;
					});
					ticking = true;
				}
			}, { passive: true });
		}

		// (header hide-on-scroll removed; using original header behavior)

		// enhance showView to adjust layout and scroll the revealed view into place
		function showView(id) {
			['view-subjects', 'view-lessons', 'view-content', 'view-profile'].forEach(v => { const el = document.getElementById(v); if (el) el.classList.add('hidden'); });
			const target = document.getElementById(id);
			if (target) {
				target.classList.remove('hidden');
				adjustForHeader();
				try { target.scrollTo({ top: 0, behavior: 'smooth' }); } catch (e) {}
			}
		}
        
		function updateBreadcrumbs() {
			const s = document.getElementById('crumb-subject'), l = document.getElementById('crumb-lesson');
			document.getElementById('crumb-subject-sep').classList.toggle('hidden', !currentSubject);
			s.classList.toggle('hidden', !currentSubject);
			if (currentSubject) s.innerText = currentSubject.title;
			document.getElementById('crumb-lesson-sep').classList.toggle('hidden', !currentLesson);
			l.classList.toggle('hidden', !currentLesson);
			if (currentLesson) l.innerText = currentLesson.title;
		}

		function renderSubjects() {
			const g = document.getElementById('subject-grid'); g.innerHTML = '';
			Object.values(subjects).forEach(sub => {
				g.innerHTML += `<div onclick="selectSubject('${sub.id}')" class="subject-card bg-white p-8 rounded-2xl border ${sub.color.split(' ')[2]} shadow-sm cursor-pointer transition flex flex-col items-center text-center">
					<div class="w-20 h-20 rounded-2xl ${sub.color.split(' ')[0]} flex items-center justify-center text-4xl mb-4 shadow-sm">${sub.icon}</div>
					<h3 class="text-xl font-extrabold text-lagro-green mb-2">${sub.title}</h3>
					<p class="text-sm text-slate-500 font-medium">${sub.desc}</p>
				</div>`;
			});
		}

		function renderLessons() {
			document.getElementById('lesson-page-title').innerText = currentSubject.title;
			const list = document.getElementById('lesson-list'); list.innerHTML = '';
			currentSubject.lessons.forEach(ls => {
				list.innerHTML += `<li onclick="selectLesson('${ls.id}')" class="lesson-item p-6 cursor-pointer transition flex justify-between items-center group">
					<div><h4 class="text-lg font-bold text-lagro-green group-hover:text-emerald-600 transition">${ls.title}</h4><p class="text-sm text-slate-500 mt-1">${ls.desc}</p></div>
					<span class="text-lagro-emerald opacity-50 group-hover:opacity-100 transition font-bold">START QUIZ ‚Üí</span>
				</li>`;
			});
		}

		function renderContent() {
			document.getElementById('content-title').innerText = currentLesson.title;
			document.getElementById('content-read').innerHTML = currentLesson.content.read;
			switchTab('read');
			renderQuiz();
		}

		function switchTab(t) {
			['read', 'visuals', 'quiz', 'flashcards'].forEach(tab => {
				const btn = document.getElementById(`tab-${tab}`);
				if (btn) btn.classList.toggle('bg-white', tab === t);
				if (btn) btn.classList.toggle('text-lagro-green', tab === t);
				const content = document.getElementById(`content-${tab}`);
				if (content) content.classList.toggle('hidden', tab !== t);
			});
			if (t === 'visuals') renderVisuals();
			if (t === 'flashcards') renderFlashcards();
		}

		function renderVisuals() {
			const c = document.getElementById('content-visuals'); c.innerHTML = '';
			const content = currentLesson.content || {};
			// prefer explicit chart object if provided
			const chartInfo = content.chart || null;
			if ((!chartInfo || !chartInfo.type) && content.chartType === 'none') {
				c.innerHTML = '<p class="text-slate-400 font-bold italic">Visual aids are not required for this topic.</p>'; return;
			}
			const cw = document.createElement('div'); cw.className = 'chart-container';
			const can = document.createElement('canvas'); cw.appendChild(can); c.appendChild(cw);
			if (currentChart) try { currentChart.destroy(); } catch (e) {}
			const ctx = can.getContext('2d');
			if (chartInfo && chartInfo.type) {
				const bg = chartInfo.backgroundColor || (chartInfo.data && chartInfo.data.length > 1 ? ['#059669', '#e6f4ee', '#10b981', '#6ee7b7'] : ['#059669']);
				currentChart = new Chart(ctx, {
					type: chartInfo.type,
					data: { labels: chartInfo.labels || [], datasets: [{ label: chartInfo.label || '', data: chartInfo.data || [], backgroundColor: bg }] },
					options: { responsive: true, maintainAspectRatio: false }
				});
				if (chartInfo.desc) {
					const p = document.createElement('p'); p.className = 'text-sm text-slate-500 mt-4'; p.innerText = chartInfo.desc; c.appendChild(p);
				}
				return;
			}
			// legacy fallback
			if (content.chartType === 'bar') {
				currentChart = new Chart(ctx, { type: 'bar', data: { labels: ['Associate', 'Bachelor', 'Master', 'Doctoral'], datasets: [{ label: 'Approx Years Required', data: [2, 4, 2, 5], backgroundColor: '#059669' }] }, options: { responsive: true, maintainAspectRatio: false }});
			} else {
				currentChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['Parental', 'Media', 'Financial', 'Personal'], datasets: [{ data: [60, 20, 10, 10], backgroundColor: ['#064e3b', '#059669', '#10b981', '#6ee7b7'] }] }, options: { responsive: true, maintainAspectRatio: false }});
			}
		}

		function renderQuiz() {
			const w = document.getElementById('quiz-wrapper'); w.innerHTML = '';
			const quiz = currentLesson.content.quiz;
			currentQuizState = { lessonId: currentLesson.id, total: quiz.length, answered: 0, correct: 0 };
			quiz.forEach((q, i) => {
				const d = document.createElement('div'); d.className = 'mb-10 p-8 bg-emerald-50/50 rounded-2xl border border-emerald-100 shadow-sm';
				let h = `<p class="font-extrabold text-lagro-green text-lg mb-6">Q${i+1}: ${q.q}</p><div class="grid gap-3">`;
				q.options.forEach((o, oi) => { h += `<button onclick="checkAnswer(this, ${q.a === oi})" data-correct="${q.a === oi}" class="w-full text-left px-5 py-4 bg-white border-2 border-transparent rounded-xl hover:border-emerald-300 transition-all font-semibold text-slate-700 shadow-sm">${o}</button>`; });
				h += `</div><p class="feedback hidden mt-5 font-bold text-center"></p>`;
				d.innerHTML = h; w.appendChild(d);
			});
			// result area
			const res = document.createElement('div'); res.id = 'quiz-result'; res.className = 'mt-6 text-center text-sm text-slate-600'; w.appendChild(res);
		}

		// Build simple flashcards from the lesson read content.
		// Preset flashcards for specific lessons (overrides generated cards)
		const presetFlashcards = {
			"s1": [
				{ front: "Goldilocks Zone", back: "The habitable region around a star where temperature allows liquid water to exist." },
				{ front: "Venus", back: "The hottest planet due to its thick greenhouse-gas-rich atmosphere." },
				{ front: "Magnetic Field", back: "Protects Earth from harmful solar radiation and maintains our atmosphere." },
				{ front: "71%", back: "The percentage of Earth's surface covered by liquid water." },
				{ front: "Ozone Layer", back: "The part of the stratosphere that blocks harmful Ultraviolet (UV) radiation." },
				{ front: "Terrestrial Planets", back: "Mercury, Venus, Earth, and Mars; known for being rocky and solid." },
				{ front: "Gas Giants", back: "Jupiter and Saturn; massive planets made mostly of hydrogen and helium." },
				{ front: "Ice Giants", back: "Uranus and Neptune; planets containing heavier elements like oxygen, carbon, and nitrogen." },
				{ front: "Uranus", back: "The coldest planet in our solar system." },
				{ front: "Jupiter", back: "The largest planet, famous for its 'Great Red Spot' storm." },
				{ front: "Mars", back: "Known as the 'Red Planet' due to iron oxide (rust) on its surface." },
				{ front: "Mercury", back: "The smallest and closest planet to the Sun; has almost no atmosphere." },
				{ front: "Nitrogen (78%)", back: "The most abundant gas in Earth's atmosphere." },
				{ front: "Greenhouse Effect", back: "Natural process where gases like $CO_2$ trap heat to keep Earth habitable." },
				{ front: "Plate Tectonics", back: "Geological activity that recycles nutrients and carbon, stabilizing the climate." },
				{ front: "Oxygen (21%)", back: "The second most common gas on Earth, vital for complex life." },
				{ front: "Atmospheric Pressure", back: "Force exerted by the atmosphere that prevents water from boiling away or freezing." },
				{ front: "Saturn", back: "Known for its extensive and bright ring system made of ice and rock." },
				{ front: "Carbon Dioxide", back: "The gas primarily responsible for Venus's extreme runaway greenhouse effect." },
				{ front: "Core Rotation", back: "The movement of Earth's molten outer core that generates our magnetic field." }
			],
			"S2": [
				{ front: "Is the Greenhouse Effect naturally bad?", back: "No, it is essential for life to regulate temperature." },
				{ front: "What does the 'Blanket Analogy' explain?", back: "How the atmosphere lets sunlight in but traps heat to keep Earth warm." },
				{ front: "Which gas is the most abundant natural GHG?", back: "Water Vapor." },
				{ front: "Primary source of human-emitted Carbon Dioxide?", back: "Burning fossil fuels and deforestation." },
				{ front: "What does $CH_4$ stand for?", back: "Methane." },
				{ front: "Which GHG is emitted from livestock and landfills?", back: "Methane." },
				{ front: "What are synthetic GHGs used in refrigerants called?", back: "Fluorinated Gases (CFCs/HFCs)." },
				{ front: "Define 'Re-emit'.", back: "To send energy back out after it has been absorbed." },
				{ front: "Main consequence of human-enhanced greenhouse effect?", back: "Global warming and climate change." },
				{ front: "What happens if Earth has no 'blanket'?", back: "It would be too cold for life to exist." },
				{ front: "Potent gas resulting from fertilizers?", back: "Nitrous Oxide ($N_2O$)." },
				{ front: "Define 'Absorb'.", back: "To take in or soak up energy." },
				{ front: "What is Solar Radiation?", back: "Energy or sunlight coming from the sun." },
				{ front: "What is 'Ground-level Ozone'?", back: "A pollutant from vehicle/industrial emissions that also traps heat." },
				{ front: "Difference between Reflect and Absorb?", back: "Reflect bounces off; Absorb soaks in." },
				{ front: "What is a 'Feedback Loop' in warming?", back: "When a process (like water vapor increase) amplifies the initial warming." },
				{ front: "What happens when the 'blanket' becomes too thick?", back: "The planet over-warms (Global Warming)." },
				{ front: "Where does Nitrous Oxide come from?", back: "Fertilizers and industrial processes." },
				{ front: "Most abundant human-emitted GHG?", back: "Carbon Dioxide ($CO_2$)." },
				{ front: "Natural vs Enhanced effect?", back: "Natural maintains balance; Enhanced traps too much heat." }
			],
			"l1": [
				{ front: "Associate Degree", back: "A 2-year undergraduate program usually taken at a community or technical college." },
				{ front: "Bachelor‚Äôs Degree", back: "A 3-4 year university degree focused on a specific academic major." },
				{ front: "Master‚Äôs Degree", back: "A graduate level program taken 1-2 years after completing a Bachelor's." },
				{ front: "Doctoral Degree", back: "The highest academic level, taking 3-7 years and focused on original research." },
				{ front: "Accelerated Programs", back: "Faster completion routes (e.g., 3-year bachelor's) often using year-round study." },
				{ front: "Apprenticeships", back: "Work-based learning combined with classroom instruction in skilled trades." },
				{ front: "Traineeships", back: "Work-based learning similar to apprenticeships, but usually shorter and less technical." },
				{ front: "Foundation Year", back: "A one-year program to prepare students for undergraduate study." },
				{ front: "Bridging Courses", back: "Short programs to help students meet specific academic prerequisites for a course." },
				{ front: "2+2 Program", back: "A transfer path: 2 years for an associate degree + 2 years at a university for a bachelor's." },
				{ front: "Articulation Agreement", back: "Formal partnerships between schools that simplify the credit transfer process." },
				{ front: "MOOCs", back: "Massive Open Online Courses; large-scale, often free online learning." },
				{ front: "Microcredentials", back: "Targeted, short-term learning focused on a specific practical skill." },
				{ front: "Blended Learning", back: "An educational approach combining online digital media with traditional classroom methods." },
				{ front: "Pre-Professional Programs", back: "Tracks specifically designed to prepare students for careers like medicine or law." }
			],
			"l2": [
				{ front: "What does a 'Whole Person' lens consider in career development?", back: "Skills, interests, values, personality, life circumstances, and cultural background." },
				{ front: "True or False: Career pathways are linear and follow a straight line.", back: "False. Pathways are non-linear and subject to change." },
				{ front: "Which influence is recognized as the 'most significant' factor in career choice?", back: "Parental Influence." },
				{ front: "How do TikTok and YouTube trends (vloggers, K-pop) affect career choice?", back: "Through Peer/Media Exposure that shapes dreams and aspirations." },
				{ front: "What is the primary driver for students choosing TESDA NC over 4-year degrees?", back: "Financial Constraints (seeking quicker routes to the workforce)." },
				{ front: "How do societal 'Gender Roles' influence career paths for females?", back: "They often push females toward teaching or caregiving roles." },
				{ front: "How do societal 'Gender Roles' influence career paths for males?", back: "They often push males toward engineering or technical roles." },
				{ front: "What happens when Interest/Aptitude conflicts with Parental Pressure?", back: "Interest is central, but external pressures can override it (e.g., Medicine vs IT)." },
				{ front: "What is the core focus of Academic pathways?", back: "Theoretical and research-based learning." },
				{ front: "What is the core focus of Vocational pathways?", back: "Practical, hands-on, skills-based learning." }
			],
			"l3": [
				{ front: "What three things define the 'nature' of an employment type?", back: "Work hours, duration, and the worker-employer relationship." },
				{ front: "Which employment type is considered permanent and offers job security?", back: "Full-Time employment." },
				{ front: "How are Part-Time workers typically paid?", back: "They are typically paid an hourly wage with limited or no benefits." },
				{ front: "What is the main drawback of 'Casual' employment?", back: "It provides no job security or paid leave." },
				{ front: "When does 'Seasonal' employment end?", back: "It ends when the specific season it was hired for is over." },
				{ front: "In 'Gig' work, what is the legal status of the worker?", back: "They are an independent contractor, not a traditional employee." },
				{ front: "Who handles the taxes and benefits for a Freelancer?", back: "The Freelancer handles them personally as they operate their own business." },
				{ front: "What defines 'Contractual' employment?", back: "A contract outlining specific start/end dates, scope of work, and pay." },
				{ front: "From which language does the word 'resume' originate?", back: "French (r√©sum√©)." },
				{ front: "What is the literal translation of the word 'r√©sum√©'?", back: "It means 'summary'." }
			]
			,
			"P1": [
				{ front: "Define the Zeroth Law of Thermodynamics.", back: "If A and B are in thermal equilibrium with C, then A and B are in equilibrium with each other." },
				{ front: "What concept does the Zeroth Law define?", back: "Temperature." },
				{ front: "What is Temperature measuring?", back: "The average kinetic energy of particles in a substance." },
				{ front: "Is Temperature the same as total Heat energy?", back: "No. Total heat depends on mass and material; temperature is an average." },
				{ front: "What is the SI unit for temperature?", back: "Kelvin (K)." },
				{ front: "Define Heat.", back: "Energy in transit transferred due to temperature difference." },
				{ front: "What direction does heat spontaneously flow?", back: "From higher temperature to lower temperature." },
				{ front: "In what units is heat energy measured?", back: "Joules (J) or calories." },
				{ front: "Define Conduction.", back: "Heat transfer through direct contact or electron movement, mainly in solids." },
				{ front: "Which is generally the slowest method of heat transfer?", back: "Conduction." },
				{ front: "Define Convection.", back: "Heat transfer by the actual movement of fluids (liquids or gases)." },
				{ front: "What is a Convection Current?", back: "A cycle where warm fluid rises and cooler fluid replaces it." },
				{ front: "What happens to fluid density when it warms?", back: "It expands and becomes less dense, causing it to rise." },
				{ front: "List 2 examples of Convection.", back: "Boiling water and ocean currents." },
				{ front: "Define Radiation.", back: "Heat transfer by electromagnetic waves." },
				{ front: "Does Radiation require a medium?", back: "No, it can travel through a vacuum." },
				{ front: "What is the speed of Radiation?", back: "The speed of light (3 x 10^8 m/s)." },
				{ front: "What is the fastest method of heat transfer?", back: "Radiation." },
				{ front: "Example of Radiation in space?", back: "Sunlight warming the Earth." },
				{ front: "When does heat flow stop?", back: "When thermal equilibrium (equal temperature) is reached." }
			]
		};

		function buildFlashcardsFromLesson(lesson, minCards = 15) {
			const out = [];
			if (!lesson || !lesson.content || !lesson.content.read) return out;
			const tmp = document.createElement('div'); tmp.innerHTML = lesson.content.read;
			let text = (tmp.innerText || tmp.textContent || '').replace(/\s+/g, ' ').trim();
			if (!text) return out;
			// split into sentences
			let parts = text.split(/(?<=[\.\?!])\s+/).map(s=>s.trim()).filter(s=>s.length>20);
			// fallback: collect headings/paragraphs
			if (parts.length < minCards) {
				parts = [];
				Array.from(tmp.querySelectorAll('h1,h2,h3,h4,h5,p,li')).forEach(el => {
					const t = (el.innerText||el.textContent||'').trim(); if (t && t.length>20) parts.push(t);
				});
			}
			// ensure at least minCards
			if (parts.length === 0) parts = [text];
			let i = 0;
			while (out.length < minCards) {
				const p = parts[i % parts.length];
				const front = p.length > 80 ? p.slice(0,80).trim() + '‚Ä¶' : p;
				out.push({ front, back: p });
				i++;
				if (i>1000) break;
			}
			return out;
		}

		let currentFlashcardsArr = [];
		let currentFlashIndex = 0;



		function shuffleArray(a) {
			for (let i = a.length - 1; i > 0; i--) {
				const j = Math.floor(Math.random() * (i + 1));
				[a[i], a[j]] = [a[j], a[i]];
			}
		}

        

		function showFlashcard(i) {
			const frontEl = document.getElementById('card-front-text');
			const backEl = document.getElementById('card-back-text');
			const indexEl = document.getElementById('card-counter');
			const cardEl = document.getElementById('flashcard-card');
			const inner = document.getElementById('flashcard-inner');
			const saveBtn = document.getElementById('fc-save');
			if (!frontEl || !backEl || !indexEl || !cardEl || !inner) return;
			if (!currentFlashcardsArr || currentFlashcardsArr.length === 0) {
				frontEl.innerText = 'No flashcards available.';
				backEl.innerText = '';
				indexEl.innerText = '0 / 0';
				return;
			}
			currentFlashIndex = (i + currentFlashcardsArr.length) % currentFlashcardsArr.length;
			const c = currentFlashcardsArr[currentFlashIndex];
			frontEl.innerText = c.front;
			backEl.innerText = c.back;
			indexEl.innerText = `${currentFlashIndex+1} / ${currentFlashcardsArr.length}`;
			// reset flip state
			inner.classList.remove('is-flipped');
			// no save/print controls
			cardEl.focus && cardEl.focus();
		}

		function flipCurrentFlashcard() {
			const inner = document.getElementById('flashcard-inner');
			if (!inner) return;
			inner.classList.toggle('is-flipped');
		}

		function renderFlashcards() {
			const stage = document.getElementById('flashcard-stage');
			if (!stage) return;
			if (!currentLesson) {
				stage.innerHTML = '<div class="text-sm text-slate-500">No lesson selected.</div>';
				return;
			}
			const preset = presetFlashcards[currentLesson.id];
			currentFlashcardsArr = Array.isArray(preset) ? preset.slice() : buildFlashcardsFromLesson(currentLesson, 15);
			if (!currentFlashcardsArr || currentFlashcardsArr.length === 0) {
				stage.innerHTML = '<div class="text-sm text-slate-500">No flashcards available.</div>';
				return;
			}
			// initialize view to first card
			showFlashcard(0);

			// attach handlers
			const prev = document.getElementById('fc-prev');
			const next = document.getElementById('fc-next');
			const cardEl = document.getElementById('flashcard-card');
			const shuffleBtn = document.getElementById('fc-shuffle');
			if (prev) prev.onclick = () => showFlashcard(currentFlashIndex - 1);
			if (next) next.onclick = () => showFlashcard(currentFlashIndex + 1);
			if (shuffleBtn) shuffleBtn.onclick = () => { shuffleArray(currentFlashcardsArr); showFlashcard(0); };

			if (cardEl) {
				cardEl.onclick = () => flipCurrentFlashcard();
				// keyboard: left/right for nav, space/enter to flip
				cardEl.tabIndex = 0;
				cardEl.onkeydown = (e) => {
					if (e.key === 'ArrowLeft') { showFlashcard(currentFlashIndex - 1); e.preventDefault(); }
					else if (e.key === 'ArrowRight') { showFlashcard(currentFlashIndex + 1); e.preventDefault(); }
					else if (e.key === ' ' || e.key === 'Enter') { flipCurrentFlashcard(); e.preventDefault(); }
				};
			}
			// global keyboard support too
			document.onkeydown = (e) => {
				if (document.getElementById('content-flashcards') && !document.getElementById('content-flashcards').classList.contains('hidden')) {
					if (e.key === 'ArrowLeft') showFlashcard(currentFlashIndex - 1);
					else if (e.key === 'ArrowRight') showFlashcard(currentFlashIndex + 1);
					else if (e.key === ' ' || e.key === 'Enter') { flipCurrentFlashcard(); e.preventDefault(); }
				}
			};
		}

		// Profile handling
		let profile = { name: 'Guest User', email: '' };

		function loadProfile() {
			try {
				const raw = localStorage.getItem('lagro_profile');
				if (raw) profile = JSON.parse(raw);
			} catch (e) { profile = { name: 'Guest User', email: '' }; }
			// normalize older profile data formats
			try {
				if (profile && profile.studyEffectiveness != null) {
					if (typeof profile.studyEffectiveness === 'number' && profile.studyEffectiveness <= 1) profile.studyEffectiveness = profile.studyEffectiveness * 100;
				}
				if (profile && profile.percentRecords) {
					for (const k in profile.percentRecords) {
						let v = profile.percentRecords[k];
						if (typeof v === 'number' && v <= 1) profile.percentRecords[k] = Math.round(v * 100);
					}
				}
			} catch(e) {}
			updateProfileUI();
		}

		function updateProfileUI() {
			const elName = document.getElementById('profile-name');
			const elAvatar = document.getElementById('profile-avatar');
			const menu = document.getElementById('menu-body');
			if (elName) elName.innerText = profile.name || 'User';
			if (elAvatar) {
				const parts = (profile.name || 'U').split(' ').filter(Boolean);
				const initials = parts.length === 1 ? parts[0].slice(0,1) : (parts[0][0] + (parts[1] ? parts[1][0] : ''));
				elAvatar.innerText = (initials || 'U').toUpperCase();
			}
			if (!menu) return;
			// Build dynamic menu depending on login state
			if (profile && profile.email) {
				menu.innerHTML = `
					<div class="p-3 border-b text-sm text-slate-700">Signed in as <strong id="menu-username">${escapeHtml(profile.name)}</strong></div>
					<button onclick="showProfilePage()" class="w-full text-left px-4 py-2 hover:bg-emerald-50">View Profile</button>
					<button onclick="goHome()" class="w-full text-left px-4 py-2 hover:bg-emerald-50">Dashboard</button>
					<button onclick="logout()" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50">Logout</button>
				`;
			} else {
				menu.innerHTML = `
					<div class="p-3 border-b text-sm text-slate-700">Not signed in</div>
					<button onclick="openLoginModal()" class="w-full text-left px-4 py-2 hover:bg-emerald-50">Sign In</button>
					<button onclick="openProfileModal()" class="w-full text-left px-4 py-2 hover:bg-emerald-50">Create Profile</button>
					<button onclick="goHome()" class="w-full text-left px-4 py-2 hover:bg-emerald-50">Dashboard</button>
				`;
			}

			// Add dark mode toggle to menu footer
			const footer = document.createElement('div');
			footer.className = 'p-3 border-t';
			footer.innerHTML = `<div class="flex items-center justify-between text-sm"><div>Dark Mode</div><button id="dark-toggle" class="px-3 py-1 rounded bg-slate-100">Toggle</button></div>`;
			menu.appendChild(footer);
			const dt = footer.querySelector('#dark-toggle');
			if (dt) {
				// initialize label
				dt.innerText = document.body.classList.contains('dark') ? 'On' : 'Off';
				dt.setAttribute('aria-pressed', document.body.classList.contains('dark') ? 'true' : 'false');
				dt.addEventListener('click', () => {
					const isNowDark = document.body.classList.contains('dark');
					// toggleDarkMode expects no arg to flip, but we want to flip and then reflect the new state
					toggleDarkMode(!isNowDark);
					dt.innerText = document.body.classList.contains('dark') ? 'On' : 'Off';
					dt.setAttribute('aria-pressed', document.body.classList.contains('dark') ? 'true' : 'false');
				});
			}
			// update GPA displays every time the menu changes
			populateProfileDisplays();
		}

		// populate modal and header GPA displays
		function populateProfileDisplays() {
			const gpaEl = document.getElementById('profile-gpa');
			const listEl = document.getElementById('profile-gpa-list');
			const badge = document.getElementById('profile-gpa-badge');
			const val = (profile && typeof profile.gpa === 'number') ? profile.gpa : null;
			if (gpaEl) gpaEl.innerText = val !== null ? val.toFixed(2) : '‚Äî';
			if (badge) {
				if (val !== null) { badge.innerText = `GPA ${val.toFixed(2)}`; badge.classList.remove('hidden'); }
				else { badge.innerText = '‚Äî'; badge.classList.add('hidden'); }
			}
			if (listEl) {
				const rec = profile.gpaRecords || {};
				const keys = Object.keys(rec);
				if (!keys.length) { listEl.innerHTML = '<em>No lesson GPAs yet.</em>'; return; }
				let html = '<ul class="list-disc pl-4">';
				keys.forEach(k => { html += `<li>${escapeHtml(k)}: <strong>${(rec[k]||0).toFixed(2)}</strong></li>`; });
				html += '</ul>';
				listEl.innerHTML = html;
			}
			// show study effectiveness in menu/profile small badge if available
			let eff = (profile && typeof profile.studyEffectiveness === 'number') ? profile.studyEffectiveness : null;
			if (eff !== null && eff <= 1) eff = Math.round(eff * 100);
			const effBadge = document.getElementById('profile-gpa-badge');
			if (effBadge && eff !== null) {
				const gtext = val !== null ? val.toFixed(2) : '‚Äî';
				effBadge.innerText = `GPA ${gtext} ¬∑ ${Math.round(eff)}%`;
				effBadge.classList.remove('hidden');
			}
		}

		function showProfilePage() {
			renderProfilePage();
			showView('view-profile');
			// layout handled globally by showView()/adjustForHeader()
			// update breadcrumbs: show Profile as current
			document.getElementById('crumb-subject-sep').classList.remove('hidden');
			const s = document.getElementById('crumb-subject'); s.classList.remove('hidden'); s.innerText = 'Profile';
			document.getElementById('crumb-lesson-sep').classList.add('hidden'); document.getElementById('crumb-lesson').classList.add('hidden');
		}

		let profileGpaChart = null, profileBarChart = null;

		function renderProfilePage() {
			document.getElementById('profile-page-name').innerText = profile.name || 'Guest User';
			document.getElementById('profile-page-email').innerText = profile.email || '‚Äî';
			document.getElementById('profile-page-avatar').innerText = (function(){
				const parts = (profile.name||'U').split(' ').filter(Boolean);
				const initials = parts.length === 1 ? parts[0].slice(0,1) : (parts[0][0] + (parts[1]?parts[1][0]:''));
				return (initials||'U').toUpperCase();
			})();
			const g = (profile && typeof profile.gpa === 'number') ? profile.gpa.toFixed(2) : '‚Äî';
			document.getElementById('profile-page-gpa').innerText = g;
			const eff = (profile && typeof profile.studyEffectiveness === 'number') ? Math.round(profile.studyEffectiveness) + '%' : '‚Äî';
			document.getElementById('profile-page-effectiveness').innerText = eff;
			const listEl = document.getElementById('profile-page-gpa-list');
			const rec = profile.gpaRecords || {};
			const pctRec = profile.percentRecords || {};
			const keys = Object.keys(rec);
			if (!keys.length) { listEl.innerHTML = '<em>No lesson GPAs yet.</em>'; return; }
			let html = '<ul class="pl-0">';
			keys.forEach(k => {
				const found = findLessonById(k);
				const title = found ? escapeHtml(found.lesson.title) : escapeHtml(k);
				const gpaVal = (rec[k] || 0).toFixed(2);
				const pct = (typeof pctRec[k] === 'number') ? Math.round(pctRec[k]) : 0;
				html += `\
					<li class="mb-4">\
						<div class="flex items-center justify-between">\
							<div class="text-sm text-slate-700">${title} <span class="text-xs text-slate-400">(${pct}%)</span></div>\
							<div class="text-sm font-bold text-lagro-green">${gpaVal}</div>\
						</div>\
						<div class="w-full bg-slate-100 rounded-full h-2 mt-2 overflow-hidden">\
							<div class="h-2 bg-emerald-400" style="width:${Math.min(100, Math.max(0, pct))}%"></div>\
						</div>\
					</li>`;
			});
			html += '</ul>';
			listEl.innerHTML = html;

			// Draw donut chart for GPA (4.0 scale)
			try { if (profileGpaChart) profileGpaChart.destroy(); } catch (e) {}
			const donut = document.getElementById('gpa-donut');
			if (donut) {
				const gval = (profile && typeof profile.gpa === 'number') ? profile.gpa : 0;
				const data = { datasets: [{ data: [gval, Math.max(0, 4 - gval)], backgroundColor: ['#059669', '#e6f4ee'] }], labels: ['GPA','Remaining'] };
				profileGpaChart = new Chart(donut.getContext('2d'), { type: 'doughnut', data, options: { cutout: '70%', plugins: { legend: { display: false }, tooltip: { enabled: false } } } });
				try {
					const container = donut.parentElement;
					if (container) {
						container.style.position = 'relative';
						let center = container.querySelector('#gpa-center-label');
						if (!center) {
							center = document.createElement('div');
							center.id = 'gpa-center-label';
							container.appendChild(center);
						}
						center.style.position = 'absolute';
						center.style.left = '50%';
						center.style.top = '50%';
						center.style.transform = 'translate(-50%,-50%)';
						center.style.pointerEvents = 'none';
						center.style.fontWeight = '700';
						center.style.color = '#065f46';
						center.style.fontSize = '1.25rem';
						const gval = (profile && typeof profile.gpa === 'number') ? profile.gpa.toFixed(2) : '‚Äî';
						center.innerText = gval;
					}
				} catch (e) {}
			}

			// Draw bar chart for lesson percentages (if available)
			try { if (profileBarChart) profileBarChart.destroy(); } catch (e) {}
			const bar = document.getElementById('gpa-bar');
			if (bar) {
				const percRec = profile.percentRecords || {};
				const keys = Object.keys(percRec);
				const labels = keys.map(k => {
					const found = findLessonById(k);
					return found ? escapeHtml(found.lesson.title) : escapeHtml(k);
				});
				const vals = keys.map(k => {
					let v = percRec[k];
					if (typeof v === 'number' && v <= 1) v = Math.round(v * 100);
					return v;
				});
				const bdata = { labels, datasets: [{ label: 'Percent', data: vals, backgroundColor: '#10b981' }] };
				if (labels.length > 0) {
					profileBarChart = new Chart(bar.getContext('2d'), { type: 'bar', data: bdata, options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, max: 100 } } } });
				} else {
					bar.getContext('2d').clearRect(0,0,bar.width,bar.height);
					// show placeholder text
					bar.parentElement.innerHTML = '<div class="text-sm text-slate-400">No lesson data to display.</div>';
				}
			}
			// Effectiveness progress bar
			let effVal = (profile && typeof profile.studyEffectiveness === 'number') ? profile.studyEffectiveness : null;
			if (effVal !== null && effVal <= 1) effVal = Math.round(effVal * 100);
			effVal = effVal !== null ? Math.round(effVal) : null;
			const effBar = document.getElementById('effectiveness-bar');
			const effLabel = document.getElementById('effectiveness-label');
			if (effVal !== null && effBar && effLabel) {
				effBar.style.width = `${Math.min(100, Math.max(0, effVal))}%`;
				effLabel.innerText = `${effVal}% average completion`; 
			} else if (effLabel) { effLabel.innerText = 'No study data yet.'; }

			// Recommendations: pick lowest-performing lessons (percent) or those below threshold
			const recContainer = document.getElementById('profile-page-recommendations');
			if (recContainer) {
				// Only show recommendations if overall GPA is below 3.0
				const overallGpa = (profile && typeof profile.gpa === 'number') ? profile.gpa : null;
				if (overallGpa !== null && overallGpa >= 3.0) {
					// clear recommendations when GPA is satisfactory
					recContainer.innerHTML = '';
				} else {
					const percRec = profile.percentRecords || {};
					const items = Object.keys(percRec).map(k => ({ id: k, pct: percRec[k] }));
					if (!items.length) { recContainer.innerHTML = '<em>No recommendations yet ‚Äî take quizzes to get insights.</em>'; }
					else {
						// normalize percent values (handle 0..1 stored as fraction)
						items.forEach(it => { if (typeof it.pct === 'number' && it.pct <= 1) it.pct = Math.round(it.pct * 100); });
						// sort ascending (lowest first)
						items.sort((a,b) => a.pct - b.pct);
						// choose lessons below 75% or the 3 lowest
						const threshold = 75;
						const filtered = items.filter(x => x.pct < threshold);
						const pick = (filtered.length ? filtered : items.slice(0, Math.min(3, items.length)));
						let out = '<ul class="space-y-2">';
						pick.forEach(it => {
							const found = findLessonById(it.id);
							const title = found ? escapeHtml(found.lesson.title) : escapeHtml(it.id);
							out += `<li class="flex items-center justify-between"><div>${title} <span class="text-xs text-slate-400">(${Math.round(it.pct)}%)</span></div><div><button onclick="goToLessonFromProfile('${it.id}')" class="px-3 py-1 rounded bg-emerald-50 text-emerald-700 text-xs">Study</button></div></li>`;
						});
						out += '</ul>';
						recContainer.innerHTML = out;
					}
				}
			}
		}

		function findLessonById(lessonId) {
			for (const sid in subjects) {
				const sub = subjects[sid];
				const lesson = (sub.lessons || []).find(l => l.id === lessonId);
				if (lesson) return { subjectId: sid, subject: sub, lesson };
			}
			return null;
		}

		function goToLessonFromProfile(lessonId) {
			const found = findLessonById(lessonId);
			if (!found) { alert('Lesson not found'); return; }
			currentSubject = subjects[found.subjectId];
			currentLesson = found.lesson; 
			// render content directly
			renderContent();
			showView('view-content');
			updateBreadcrumbs();
		}

		function escapeHtml(str) {
			return String(str).replace(/[&<>"]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s]));
		}

		// Login modal handlers
		function openLoginModal() {
			const m = document.getElementById('login-modal'); if (!m) return; m.classList.remove('hidden'); m.classList.add('flex');
			const pm = document.getElementById('profile-menu'); if (pm) pm.classList.add('hidden');
		}

		function closeLoginModal() { const m = document.getElementById('login-modal'); if (!m) return; m.classList.add('hidden'); m.classList.remove('flex'); }

		function performLogin() {
			const email = (document.getElementById('login-email')||{}).value || '';
			const pwd = (document.getElementById('login-password')||{}).value || '';
			if (!email || !pwd) { alert('Please enter email and password (demo).'); return; }
			// Demo-only: create profile from email
			const nameGuess = email.split('@')[0].replace(/[._\-]/g,' ').replace(/\d+/g,' ');
			profile = { name: (nameGuess.split(' ').map(s=>s[0]?.toUpperCase()+s.slice(1)).join(' ') || email), email: email };
			try { localStorage.setItem('lagro_profile', JSON.stringify(profile)); } catch (e) {}
			updateProfileUI(); closeLoginModal();
		}

		function toggleProfileMenu(e) {
			e.stopPropagation();
			const m = document.getElementById('profile-menu');
			if (m) m.classList.toggle('hidden');
		}

		document.addEventListener('click', () => { const m = document.getElementById('profile-menu'); if (m) m.classList.add('hidden'); });

		function openProfileModal() {
			const m = document.getElementById('profile-modal');
			if (!m) return;
			document.getElementById('input-name').value = profile.name || '';
			document.getElementById('input-email').value = profile.email || '';
			m.classList.remove('hidden'); m.classList.add('flex');
			const pm = document.getElementById('profile-menu'); if (pm) pm.classList.add('hidden');
		}

		function closeProfileModal() {
			const m = document.getElementById('profile-modal'); if (!m) return; m.classList.add('hidden'); m.classList.remove('flex');
		}

		function saveProfile() {
			const n = document.getElementById('input-name').value.trim();
			const e = document.getElementById('input-email').value.trim();
			profile.name = n || profile.name;
			profile.email = e || profile.email;
			try { localStorage.setItem('lagro_profile', JSON.stringify(profile)); } catch (err) { }
			updateProfileUI(); closeProfileModal();
		}

		function logout() {
			try { localStorage.removeItem('lagro_profile'); } catch (e) {}
			profile = { name: 'Guest User', email: '' };
			updateProfileUI();
		}

		// Dark mode support
		function toggleDarkMode(enable) {
			if (typeof enable === 'boolean') {
				document.body.classList.toggle('dark', enable);
				localStorage.setItem('lagro_dark', enable ? '1' : '0');
				return;
			}
			const isDark = document.body.classList.toggle('dark');
			localStorage.setItem('lagro_dark', isDark ? '1' : '0');
		}

		// initialize dark mode from storage
		try { if (localStorage.getItem('lagro_dark') === '1') document.body.classList.add('dark'); } catch(e) {}

		window.checkAnswer = function(btn, isCorrect) {
			const p = btn.parentElement; const f = p.parentElement.querySelector('.feedback');
			Array.from(p.children).forEach(b => { b.disabled = true; b.classList.add('opacity-40'); });
			btn.classList.replace('border-transparent', isCorrect ? 'border-green-500' : 'border-red-500');
			btn.classList.add(isCorrect ? 'bg-green-50' : 'bg-red-50');
			btn.classList.remove('opacity-40');
			f.innerText = isCorrect ? "CORRECT ‚úÖ" : "WRONG ‚ùå";
			f.className = `feedback mt-5 font-black text-center ${isCorrect ? 'text-green-600' : 'text-red-600'}`;
			f.classList.remove('hidden');

			// update quiz state
			if (!currentQuizState) return;
			currentQuizState.answered += 1;
			if (isCorrect) currentQuizState.correct += 1;

			// when finished, compute lesson score and GPA
			if (currentQuizState.answered >= currentQuizState.total) {
				const percent = Math.round((currentQuizState.correct / currentQuizState.total) * 100);
				const lessonGpa = computeLessonGPA(percent);
				// update profile records (store percent and gpa)
				updateProfileGPA(currentQuizState.lessonId, lessonGpa, percent);
				const res = document.getElementById('quiz-result');
				if (res) res.innerHTML = `<div class="p-4 rounded-md bg-white border text-slate-700 shadow-sm">You scored <strong>${percent}%</strong>. Lesson GPA: <strong>${lessonGpa.toFixed(2)}</strong>. Overall GPA: <strong>${(profile.gpa || 0).toFixed(2)}</strong></div>`;
			}
		};

		function computeLessonGPA(percent) {
			if (percent >= 90) return 4.0;
			if (percent >= 80) return 3.5;
			if (percent >= 70) return 3.0;
			if (percent >= 60) return 2.5;
			return 2.0;
		}

		function updateProfileGPA(lessonId, lessonGpa, percent) {
			if (!profile) profile = { name: 'Guest User', email: '' };
			if (!profile.gpaRecords) profile.gpaRecords = {};
			if (!profile.percentRecords) profile.percentRecords = {};
			profile.gpaRecords[lessonId] = lessonGpa;
			if (typeof percent === 'number') profile.percentRecords[lessonId] = percent;
			// normalize stored percent (allow both 0..1 and 0..100 inputs)
			try {
				if (profile.percentRecords && typeof profile.percentRecords[lessonId] === 'number') {
					let pv = profile.percentRecords[lessonId];
					if (pv <= 1) pv = Math.round(pv * 100);
					profile.percentRecords[lessonId] = pv;
				}
			} catch (e) {}
			const gvals = Object.values(profile.gpaRecords || {});
			const gavg = gvals.reduce((s, v) => s + v, 0) / (gvals.length || 1);
			profile.gpa = gavg;
			const pvals = Object.values(profile.percentRecords || {});
			const pavg = pvals.length ? (pvals.reduce((s, v) => s + v, 0) / pvals.length) : null;
			profile.studyEffectiveness = pavg;
			try { localStorage.setItem('lagro_profile', JSON.stringify(profile)); } catch (e) {}
			updateProfileUI();
		}

		document.addEventListener('DOMContentLoaded', () => { loadProfile(); renderSubjects(); initHeaderScroll(); adjustForHeader(); });
	</script>

</body>
</html>
